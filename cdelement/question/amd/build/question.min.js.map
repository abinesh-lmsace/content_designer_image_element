{"version":3,"file":"question.min.js","sources":["../src/question.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Question element - Module to resize the question embeded frame.\r\n *\r\n * @module    cdelement_question/question\r\n * @copyright  2024 bdecent gmbh <https://bdecent.de>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(['mod_contentdesigner/elements'], function (Elements) {\r\n\r\n    /**\r\n     * REsize the question element frame height.\r\n     *\r\n     * @param {HTMLElement} questionFrame\r\n     */\r\n    const resizeQuestionFrame = (questionFrame) => {\r\n        questionFrame.style.minHeight = '200px';\r\n        var height = questionFrame.contentWindow.document.documentElement.scrollHeight;\r\n        height += 50;\r\n        questionFrame.style.minHeight = height + 'px';\r\n    };\r\n\r\n    /**\r\n     * Update the warning message and referesh the question frame content when the question is submitted.\r\n     *\r\n     * @param {Integer} instanceID\r\n     * @returns\r\n     */\r\n    const questionSubmitted = (instanceID) => {\r\n\r\n        var question = document.querySelector('.element-question .element-content[data-instanceid=\"' + instanceID + '\"]');\r\n\r\n        if (question === null) {\r\n            return false;\r\n        }\r\n\r\n        const questionFrame = question.querySelector('iframe');\r\n\r\n        const handleLoad = () => {\r\n\r\n            var responseFrom = questionFrame.contentDocument.querySelector('form#responseform');\r\n            resizeQuestionFrame(questionFrame);\r\n            responseFrom.addEventListener('contentdesigner.questionformsubmitted', function () {\r\n                Elements.removeWarning();\r\n                Elements.refreshContent();\r\n            });\r\n        };\r\n\r\n        const questionFrameLoaded = (iframe, callback) => {\r\n\r\n            let checkLoad = setInterval(() => {\r\n\r\n                if (questionFrame === null) {\r\n                    clearInterval(checkLoad);\r\n                    return;\r\n                }\r\n\r\n                if (questionFrame.contentDocument === null) {\r\n                    clearInterval(checkLoad);\r\n                    return;\r\n                }\r\n\r\n                var responseFrom = questionFrame?.contentDocument.querySelector('form#responseform');\r\n\r\n                if (iframe.contentDocument.readyState === 'complete' && responseFrom) {\r\n\r\n                    const images = iframe.contentDocument.images;\r\n                    let loadedImagesCount = 0;\r\n\r\n                    const checkImagesLoaded = () => {\r\n                        loadedImagesCount++;\r\n                        if (loadedImagesCount === images.length) {\r\n                            clearInterval(checkLoad);\r\n                            callback();\r\n                        }\r\n                    };\r\n\r\n                    if (images.length > 0) {\r\n                        for (let i = 0; i < images.length; i++) {\r\n                            if (images[i].complete) {\r\n                                checkImagesLoaded();\r\n                            } else {\r\n                                images[i].addEventListener('load', checkImagesLoaded);\r\n                                images[i].addEventListener('error', checkImagesLoaded);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        clearInterval(checkLoad);\r\n                        callback();\r\n                    }\r\n                }\r\n            }, 500);\r\n        };\r\n\r\n        questionFrameLoaded(questionFrame, handleLoad);\r\n    };\r\n\r\n    /**\r\n     * Initialize the question element results.\r\n     */\r\n    const initquestion = () => {\r\n        var questions = document.querySelectorAll('.chapters-list li.element-question iframe');\r\n        questions.forEach((question) => {\r\n            var instanceid = question.dataset.instanceid;\r\n            questionSubmitted(instanceid);\r\n        });\r\n    };\r\n\r\n    return {\r\n        init: function () {\r\n            initquestion();\r\n        }\r\n    };\r\n});\r\n"],"names":["define","Elements","initquestion","document","querySelectorAll","forEach","question","instanceID","querySelector","questionFrame","iframe","callback","checkLoad","setInterval","contentDocument","responseFrom","readyState","images","loadedImagesCount","checkImagesLoaded","length","clearInterval","i","complete","addEventListener","questionFrameLoaded","style","minHeight","height","contentWindow","documentElement","scrollHeight","resizeQuestionFrame","removeWarning","refreshContent","questionSubmitted","dataset","instanceid","init"],"mappings":";;;;;;;AAsBAA,qCAAO,CAAC,iCAAiC,SAAUC,gBA4FzCC,aAAe,KACDC,SAASC,iBAAiB,6CAChCC,SAASC,WA1EIC,CAAAA,iBAEnBD,SAAWH,SAASK,cAAc,uDAAyDD,WAAa,SAE3F,OAAbD,gBACO,QAGLG,cAAgBH,SAASE,cAAc,UAYjB,EAACE,OAAQC,gBAE7BC,UAAYC,aAAY,QAEF,OAAlBJ,iBAKkC,OAAlCA,cAAcK,qBAKdC,aAAeN,MAAAA,qBAAAA,cAAeK,gBAAgBN,cAAc,wBAEtB,aAAtCE,OAAOI,gBAAgBE,YAA6BD,aAAc,OAE5DE,OAASP,OAAOI,gBAAgBG,WAClCC,kBAAoB,QAElBC,kBAAoB,KACtBD,oBACIA,oBAAsBD,OAAOG,SAC7BC,cAAcT,WACdD,gBAIJM,OAAOG,OAAS,MACX,IAAIE,EAAI,EAAGA,EAAIL,OAAOG,OAAQE,IAC3BL,OAAOK,GAAGC,SACVJ,qBAEAF,OAAOK,GAAGE,iBAAiB,OAAQL,mBACnCF,OAAOK,GAAGE,iBAAiB,QAASL,yBAI5CE,cAAcT,WACdD,iBA9BJU,cAAcT,gBALdS,cAAcT,aAsCnB,MAGPa,CAAoBhB,eAxDD,SAEXM,aAAeN,cAAcK,gBAAgBN,cAAc,qBAzB1CC,CAAAA,gBACzBA,cAAciB,MAAMC,UAAY,YAC5BC,OAASnB,cAAcoB,cAAc1B,SAAS2B,gBAAgBC,aAClEH,QAAU,GACVnB,cAAciB,MAAMC,UAAYC,OAAS,MAsBrCI,CAAoBvB,eACpBM,aAAaS,iBAAiB,yCAAyC,WACnEvB,SAASgC,gBACThC,SAASiC,wBA4DbC,CADiB7B,SAAS8B,QAAQC,sBAKnC,CACHC,KAAM,WACFpC"}