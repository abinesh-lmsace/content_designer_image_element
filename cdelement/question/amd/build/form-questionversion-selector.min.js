/**
 * Videotime instance selector for auto-complete form element.
 *
 * @module    cdelement_question/form-questionversion-selector
 * @copyright  2024 bdecent gmbh <https://bdecent.de>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("cdelement_question/form-questionversion-selector",["core/ajax","jquery"],(function(ajax,$){return{processResults:function(selector,data){var results=[],i=0;for(i=0;i<data.length;i++)results.push({value:data[i].id,label:data[i].name});return results},transport:function(selector,query,success,failure){var promises,el=document.querySelector(selector);void 0===query&&(query="");var questionid=el.dataset.questionid;""==questionid&&(questionid=0);var calls=[{methodname:"cdelement_question_get_question_variations",args:{questionid:questionid,cmid:el.dataset.cmid}}];promises=ajax.call(calls),$.when.apply($.when,promises).done((function(data){success(data)})).fail(failure)},updateQuestionID:(cmField,fieldName,noSelectionString)=>{const questionField=document.querySelector("[name="+fieldName+"]");var el=document.querySelector("[name="+cmField+"]"),cmidField=document.querySelector('input[type="hidden"][name="cmid"]');const updateField=e=>{const questionid=questionField.value;if(el.dataset.questionid=questionid,el.dataset.cmid=cmidField.value,e){el.value="";var selectionsNode=el.parentElement.querySelector(".form-autocomplete-selection")||"";if(null!==selectionsNode){var span=document.createElement("span");span.append(noSelectionString),selectionsNode.innerHTML=span.outerHTML}}};null!==questionField&&null!==el&&(updateField(!1),questionField.addEventListener("change",updateField))},updateVersion:function(element,parentSelector){const baseElement=document.querySelector('[name="'+element+'"]'),parentElement=document.querySelector('[name="'+parentSelector+'"]');if(null===baseElement)return;const updateField=e=>{var calls=[{methodname:"cdelement_question_get_question_variations",args:{questionid:parentElement.value}}];if(promises=ajax.call(calls),$.when.apply($.when,promises).done((function(data){baseElement.innerHTML="",console.log(data),data.forEach((element=>{var option=document.createElement("option");option.value=element.id,option.innerHTML=element.name,baseElement.append(option)}))})).fail(),e){baseElement.value="";var changeEvent=new Event("change");baseElement.dispatchEvent(changeEvent)}};null!==parentElement&&null!==baseElement&&(updateField(!1),parentElement.addEventListener("change",updateField))}}}));

//# sourceMappingURL=form-questionversion-selector.min.js.map