{"version":3,"file":"form-questionversion-selector.min.js","sources":["../src/form-questionversion-selector.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Videotime instance selector for auto-complete form element.\r\n *\r\n * @module    cdelement_question/form-questionversion-selector\r\n * @copyright  2024 bdecent gmbh <https://bdecent.de>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine([\r\n    'core/ajax', 'jquery'],\r\n    function (ajax, $) {\r\n\r\n        return {\r\n            // Public variables and functions.\r\n            processResults: function (selector, data) {\r\n\r\n                // Mangle the results into an array of objects.\r\n                var results = [];\r\n                var i = 0;\r\n                for (i = 0; i < data.length; i++) {\r\n                    results.push({ value: data[i].id, label: data[i].name });\r\n                }\r\n                return results;\r\n            },\r\n\r\n            transport: function (selector, query, success, failure) {\r\n                var el = document.querySelector(selector);\r\n\r\n                // Build the query.\r\n                var promises = null;\r\n\r\n                if (typeof query === \"undefined\") {\r\n                    query = '';\r\n                }\r\n\r\n                ;\r\n                var questionid = el.dataset.questionid;\r\n\r\n                if (questionid == '') {\r\n                    questionid = 0;\r\n                }\r\n\r\n                var searchargs = {\r\n                    // query: query,\r\n                    // limitfrom: 0,\r\n                    // limitnum: 100,\r\n                    questionid: questionid,\r\n                    cmid: el.dataset.cmid\r\n\r\n                };\r\n\r\n                var calls = [{\r\n                    methodname: 'cdelement_question_get_question_variations', args: searchargs\r\n                }];\r\n\r\n                // Go go go!\r\n                promises = ajax.call(calls);\r\n                $.when.apply($.when, promises).done(function (data) {\r\n                    success(data);\r\n                }).fail(failure);\r\n            },\r\n\r\n            /**\r\n             * Update the course id.\r\n             *\r\n             * @param {*} cmField\r\n             * @param {*} fieldName\r\n             */\r\n            updateQuestionID: (cmField, fieldName, noSelectionString) => {\r\n                const questionField = document.querySelector('[name=' + fieldName + ']');\r\n                var el = document.querySelector('[name=' + cmField + ']');\r\n\r\n                var cmidField = document.querySelector('input[type=\"hidden\"][name=\"cmid\"]');\r\n\r\n                const updateField = (e) => {\r\n                    const questionid = questionField.value;\r\n                    el.dataset.questionid = questionid;\r\n                    el.dataset.cmid = cmidField.value;\r\n\r\n                    if (e) {\r\n                        el.value = '';\r\n                        var selectionsNode = el.parentElement.querySelector('.form-autocomplete-selection') || '';\r\n                        if (selectionsNode !== null) {\r\n                            var span = document.createElement('span')\r\n                            span.append(noSelectionString);\r\n\r\n                            selectionsNode.innerHTML = span.outerHTML;\r\n                        }\r\n                    }\r\n                };\r\n\r\n                if (questionField !== null && el !== null) {\r\n                    updateField(false);\r\n                    questionField.addEventListener('change', updateField);\r\n                }\r\n            },\r\n\r\n\r\n            updateVersion: function (element, parentSelector) {\r\n                const baseElement = document.querySelector('[name=\"' + element + '\"]');\r\n                const parentElement = document.querySelector('[name=\"' + parentSelector + '\"]');\r\n                if (baseElement === null) {\r\n                    return;\r\n                }\r\n\r\n                const updateField = (e) => {\r\n                    const parentValue = parentElement.value;\r\n\r\n                    var searchargs = {\r\n                        // query: query,\r\n                        questionid: parentValue\r\n                    };\r\n\r\n                    var calls = [{\r\n                        methodname: 'cdelement_question_get_question_variations', args: searchargs\r\n                    }];\r\n\r\n                    promises = ajax.call(calls);\r\n                    $.when.apply($.when, promises).done(function (data) {\r\n                        baseElement.innerHTML = '';\r\n                        console.log(data);\r\n\r\n                        data.forEach(element => {\r\n                            var option = document.createElement('option');\r\n                            option.value = element.id;\r\n                            option.innerHTML = element.name;\r\n                            baseElement.append(option);\r\n                        });\r\n\r\n                    }).fail();\r\n\r\n                    if (e) {\r\n                        baseElement.value = '';\r\n                        var changeEvent = new Event('change');\r\n                        baseElement.dispatchEvent(changeEvent);\r\n                    }\r\n                };\r\n\r\n                if (parentElement !== null && baseElement !== null) {\r\n                    updateField(false);\r\n                    parentElement.addEventListener('change', updateField);\r\n                }\r\n            }\r\n        };\r\n    });\r\n"],"names":["define","ajax","$","processResults","selector","data","results","i","length","push","value","id","label","name","transport","query","success","failure","promises","el","document","querySelector","questionid","dataset","calls","methodname","args","cmid","call","when","apply","done","fail","updateQuestionID","cmField","fieldName","noSelectionString","questionField","cmidField","updateField","e","selectionsNode","parentElement","span","createElement","append","innerHTML","outerHTML","addEventListener","updateVersion","element","parentSelector","baseElement","console","log","forEach","option","changeEvent","Event","dispatchEvent"],"mappings":";;;;;;;AAuBAA,0DAAO,CACH,YAAa,WACb,SAAUC,KAAMC,SAEL,CAEHC,eAAgB,SAAUC,SAAUC,UAG5BC,QAAU,GACVC,EAAI,MACHA,EAAI,EAAGA,EAAIF,KAAKG,OAAQD,IACzBD,QAAQG,KAAK,CAAEC,MAAOL,KAAKE,GAAGI,GAAIC,MAAOP,KAAKE,GAAGM,cAE9CP,SAGXQ,UAAW,SAAUV,SAAUW,MAAOC,QAASC,aAIvCC,SAHAC,GAAKC,SAASC,cAAcjB,eAKX,IAAVW,QACPA,MAAQ,QAIRO,WAAaH,GAAGI,QAAQD,WAEV,IAAdA,aACAA,WAAa,OAYbE,MAAQ,CAAC,CACTC,WAAY,6CAA8CC,KAV7C,CAIbJ,WAAYA,WACZK,KAAMR,GAAGI,QAAQI,QASrBT,SAAWjB,KAAK2B,KAAKJ,OACrBtB,EAAE2B,KAAKC,MAAM5B,EAAE2B,KAAMX,UAAUa,MAAK,SAAU1B,MAC1CW,QAAQX,SACT2B,KAAKf,UASZgB,iBAAkB,CAACC,QAASC,UAAWC,2BAC7BC,cAAgBjB,SAASC,cAAc,SAAWc,UAAY,SAChEhB,GAAKC,SAASC,cAAc,SAAWa,QAAU,KAEjDI,UAAYlB,SAASC,cAAc,2CAEjCkB,YAAeC,UACXlB,WAAae,cAAc3B,SACjCS,GAAGI,QAAQD,WAAaA,WACxBH,GAAGI,QAAQI,KAAOW,UAAU5B,MAExB8B,EAAG,CACHrB,GAAGT,MAAQ,OACP+B,eAAiBtB,GAAGuB,cAAcrB,cAAc,iCAAmC,MAChE,OAAnBoB,eAAyB,KACrBE,KAAOvB,SAASwB,cAAc,QAClCD,KAAKE,OAAOT,mBAEZK,eAAeK,UAAYH,KAAKI,aAKtB,OAAlBV,eAAiC,OAAPlB,KAC1BoB,aAAY,GACZF,cAAcW,iBAAiB,SAAUT,eAKjDU,cAAe,SAAUC,QAASC,sBACxBC,YAAchC,SAASC,cAAc,UAAY6B,QAAU,MAC3DR,cAAgBtB,SAASC,cAAc,UAAY8B,eAAiB,SACtD,OAAhBC,yBAIEb,YAAeC,QAQbhB,MAAQ,CAAC,CACTC,WAAY,6CAA8CC,KAN7C,CAEbJ,WAJgBoB,cAAchC,YAWlCQ,SAAWjB,KAAK2B,KAAKJ,OACrBtB,EAAE2B,KAAKC,MAAM5B,EAAE2B,KAAMX,UAAUa,MAAK,SAAU1B,MAC1C+C,YAAYN,UAAY,GACxBO,QAAQC,IAAIjD,MAEZA,KAAKkD,SAAQL,cACLM,OAASpC,SAASwB,cAAc,UACpCY,OAAO9C,MAAQwC,QAAQvC,GACvB6C,OAAOV,UAAYI,QAAQrC,KAC3BuC,YAAYP,OAAOW,cAGxBxB,OAECQ,EAAG,CACHY,YAAY1C,MAAQ,OAChB+C,YAAc,IAAIC,MAAM,UAC5BN,YAAYO,cAAcF,eAIZ,OAAlBf,eAA0C,OAAhBU,cAC1Bb,aAAY,GACZG,cAAcM,iBAAiB,SAAUT"}