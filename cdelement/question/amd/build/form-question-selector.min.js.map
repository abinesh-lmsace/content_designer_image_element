{"version":3,"file":"form-question-selector.min.js","sources":["../src/form-question-selector.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Question element question selector for auto-complete form element.\r\n *\r\n * @module    cdelement_question/form-question-selector\r\n * @copyright  2024 bdecent gmbh <https://bdecent.de>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine([\r\n    'core/ajax', 'jquery'],\r\n\r\n    function (ajax, $) {\r\n\r\n\r\n        return {\r\n            // Public variables and functions.\r\n            processResults: function (selector, data) {\r\n\r\n                // Mangle the results into an array of objects.\r\n                var results = [];\r\n                var i = 0;\r\n                for (i = 0; i < data.length; i++) {\r\n                    results.push({ value: data[i].id, label: data[i].name });\r\n                }\r\n                return results;\r\n            },\r\n\r\n            transport: function (selector, query, success, failure) {\r\n                var el = document.querySelector(selector);\r\n\r\n                // Build the query.\r\n                var promises = null;\r\n\r\n                if (typeof query === \"undefined\") {\r\n                    query = '';\r\n                }\r\n\r\n                ;\r\n                var categoryid = el.dataset.categoryid;\r\n\r\n                if (categoryid == '') {\r\n                    categoryid = 1;\r\n                }\r\n\r\n                var searchargs = {\r\n                    query: query,\r\n                    limitfrom: 0,\r\n                    limitnum: 100,\r\n                    categoryid: categoryid\r\n                };\r\n\r\n                var calls = [{\r\n                    methodname: 'cdelement_question_get_question_menu', args: searchargs\r\n                }];\r\n\r\n                // Go go go!\r\n                promises = ajax.call(calls);\r\n                $.when.apply($.when, promises).done(function (data) {\r\n                    success(data);\r\n                }).fail(failure);\r\n            },\r\n\r\n            /**\r\n             * Update the course id.\r\n             *\r\n             * @param {*} cmField\r\n             * @param {*} fieldName\r\n             */\r\n            updateCategoryID: (cmField, fieldName, noSelectionString) => {\r\n\r\n\r\n                const categoryField = document.querySelector('[name=' + fieldName + ']');\r\n                var el = document.querySelector('[name=' + cmField + ']');\r\n\r\n                const updateField = (e) => {\r\n\r\n                    const categoryid = categoryField.value;\r\n                    el.dataset.categoryid = categoryid;\r\n\r\n                    if (e) {\r\n                        el.value = '';\r\n                        var selectionsNode = el.parentElement.querySelector('.form-autocomplete-selection') || '';\r\n                        if (selectionsNode !== null) {\r\n                            var span = document.createElement('span')\r\n                            span.append(noSelectionString);\r\n\r\n                            selectionsNode.innerHTML = span.outerHTML;\r\n                        }\r\n                    }\r\n                };\r\n\r\n                if (categoryField !== null && el !== null) {\r\n                    updateField(false);\r\n                    categoryField.addEventListener('change', updateField);\r\n                }\r\n            },\r\n\r\n\r\n            updateVersion: function (element, parentSelector) {\r\n                const baseElement = document.querySelector('[name=\"' + element + '\"]');\r\n                const parentElement = document.querySelector('[name=\"' + parentSelector + '\"]');\r\n                if (baseElement === null) {\r\n                    return;\r\n                }\r\n\r\n                const updateField = (e) => {\r\n                    const parentValue = parentElement.value;\r\n\r\n                    var searchargs = {\r\n                        // query: query,\r\n                        questionid: parentValue\r\n                    };\r\n\r\n                    var calls = [{\r\n                        methodname: 'cdelement_question_get_question_variations', args: searchargs\r\n                    }];\r\n\r\n                    promises = ajax.call(calls);\r\n                    $.when.apply($.when, promises).done(function (data) {\r\n                        baseElement.innerHTML = '';\r\n                        console.log(data);\r\n\r\n                        data.forEach(element => {\r\n                            var option = document.createElement('option');\r\n                            option.value = element.id;\r\n                            option.innerHTML = element.name;\r\n                            baseElement.append(option);\r\n                        });\r\n\r\n                    }).fail();\r\n\r\n                    if (e) {\r\n                        baseElement.value = '';\r\n                        var changeEvent = new Event('change');\r\n                        baseElement.dispatchEvent(changeEvent);\r\n                    }\r\n                };\r\n\r\n                if (parentElement !== null && baseElement !== null) {\r\n                    updateField(false);\r\n                    parentElement.addEventListener('change', updateField);\r\n                }\r\n            }\r\n        };\r\n    });\r\n"],"names":["define","ajax","$","processResults","selector","data","results","i","length","push","value","id","label","name","transport","query","success","failure","promises","categoryid","document","querySelector","dataset","calls","methodname","args","limitfrom","limitnum","call","when","apply","done","fail","updateCategoryID","cmField","fieldName","noSelectionString","categoryField","el","updateField","e","selectionsNode","parentElement","span","createElement","append","innerHTML","outerHTML","addEventListener","updateVersion","element","parentSelector","baseElement","questionid","console","log","forEach","option","changeEvent","Event","dispatchEvent"],"mappings":";;;;;;;AAsBAA,mDAAO,CACH,YAAa,WAEb,SAAUC,KAAMC,SAGL,CAEHC,eAAgB,SAAUC,SAAUC,UAG5BC,QAAU,GACVC,EAAI,MACHA,EAAI,EAAGA,EAAIF,KAAKG,OAAQD,IACzBD,QAAQG,KAAK,CAAEC,MAAOL,KAAKE,GAAGI,GAAIC,MAAOP,KAAKE,GAAGM,cAE9CP,SAGXQ,UAAW,SAAUV,SAAUW,MAAOC,QAASC,aAIvCC,cAEiB,IAAVH,QACPA,MAAQ,QAIRI,WAVKC,SAASC,cAAcjB,UAUZkB,QAAQH,WAEV,IAAdA,aACAA,WAAa,OAUbI,MAAQ,CAAC,CACTC,WAAY,uCAAwCC,KARvC,CACbV,MAAOA,MACPW,UAAW,EACXC,SAAU,IACVR,WAAYA,cAQhBD,SAAWjB,KAAK2B,KAAKL,OACrBrB,EAAE2B,KAAKC,MAAM5B,EAAE2B,KAAMX,UAAUa,MAAK,SAAU1B,MAC1CW,QAAQX,SACT2B,KAAKf,UASZgB,iBAAkB,CAACC,QAASC,UAAWC,2BAG7BC,cAAgBjB,SAASC,cAAc,SAAWc,UAAY,SAChEG,GAAKlB,SAASC,cAAc,SAAWa,QAAU,WAE/CK,YAAeC,UAEXrB,WAAakB,cAAc3B,SACjC4B,GAAGhB,QAAQH,WAAaA,WAEpBqB,EAAG,CACHF,GAAG5B,MAAQ,OACP+B,eAAiBH,GAAGI,cAAcrB,cAAc,iCAAmC,MAChE,OAAnBoB,eAAyB,KACrBE,KAAOvB,SAASwB,cAAc,QAClCD,KAAKE,OAAOT,mBAEZK,eAAeK,UAAYH,KAAKI,aAKtB,OAAlBV,eAAiC,OAAPC,KAC1BC,aAAY,GACZF,cAAcW,iBAAiB,SAAUT,eAKjDU,cAAe,SAAUC,QAASC,sBACxBC,YAAchC,SAASC,cAAc,UAAY6B,QAAU,MAC3DR,cAAgBtB,SAASC,cAAc,UAAY8B,eAAiB,SACtD,OAAhBC,yBAIEb,YAAeC,QAQbjB,MAAQ,CAAC,CACTC,WAAY,6CAA8CC,KAN7C,CAEb4B,WAJgBX,cAAchC,YAWlCQ,SAAWjB,KAAK2B,KAAKL,OACrBrB,EAAE2B,KAAKC,MAAM5B,EAAE2B,KAAMX,UAAUa,MAAK,SAAU1B,MAC1C+C,YAAYN,UAAY,GACxBQ,QAAQC,IAAIlD,MAEZA,KAAKmD,SAAQN,cACLO,OAASrC,SAASwB,cAAc,UACpCa,OAAO/C,MAAQwC,QAAQvC,GACvB8C,OAAOX,UAAYI,QAAQrC,KAC3BuC,YAAYP,OAAOY,cAGxBzB,OAECQ,EAAG,CACHY,YAAY1C,MAAQ,OAChBgD,YAAc,IAAIC,MAAM,UAC5BP,YAAYQ,cAAcF,eAIZ,OAAlBhB,eAA0C,OAAhBU,cAC1Bb,aAAY,GACZG,cAAcM,iBAAiB,SAAUT"}