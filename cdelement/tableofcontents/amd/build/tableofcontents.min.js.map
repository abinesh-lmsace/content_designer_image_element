{"version":3,"file":"tableofcontents.min.js","sources":["../src/tableofcontents.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Table of content element actions.\r\n *\r\n * @module cdelement_tableofcontents/tableofcontents\r\n * @copyright  2024 bdecent gmbh <https://bdecent.de>\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine([], function () {\r\n\r\n    const SELECTORS = {\r\n        actionbutton: \".toc-action-block .cta-action-btn\",\r\n        tablecontent: \".element-tableofcontents\",\r\n        tocblock: \".toc-list-block\",\r\n        cdprogressbar: \".contentdesigner-progress\",\r\n        tocprogressbar: \".toc-progressbar\",\r\n        tocchaptertitle: \".toc-chapter-title\",\r\n        tocmodtitle: \".toc-mod-title-block\",\r\n        tocblockelem: \".toc-block\",\r\n        chaptertitlelist: '.element-tableofcontents .toc-chapter-block .toc-chapter-title',\r\n        contentWrapper: '.contentdesigner-wrapper',\r\n        generaloptions: '.topinstance .item-tableofcontents .general-options',\r\n    };\r\n\r\n    const tableofcontent = () => document.querySelector(SELECTORS.tocblock);\r\n    const cdprogressbar = () => document.querySelector(SELECTORS.cdprogressbar);\r\n    const tocprogressbar = () => document.querySelectorAll(SELECTORS.tocprogressbar);\r\n    const tocblock = () => document.querySelector(SELECTORS.tocblockelem);\r\n    const actionbutton = () => document.querySelector(SELECTORS.actionbutton);\r\n    const contentWrapper = () => document.querySelector(SELECTORS.contentWrapper);\r\n    const generaloptionwrapper = () => document.querySelector(SELECTORS.generaloptions);\r\n\r\n    /**\r\n     * Initialize the table of content element actions.\r\n     */\r\n    const inittableofcontents = () => {\r\n        // Sticky scroll actions.\r\n        var contentElem = document.querySelector(SELECTORS.tablecontent);\r\n\r\n        // Add min height for the parent to avoid height adjustment during the sticky.\r\n        if (tocblock() !== null) {\r\n            var height = tocblock().getBoundingClientRect().height;\r\n            if (height) {\r\n                tocblock().parentNode.style.minHeight = height + 'px';\r\n            }\r\n        }\r\n\r\n        if (contentElem && contentElem.classList.contains('stickycontent')) {\r\n\r\n            document.querySelector('#page').addEventListener('scroll', () => {\r\n                stickycontents(false);\r\n            });\r\n            window.addEventListener('scroll', () => {\r\n                stickycontents(false);\r\n            });\r\n\r\n            // Popup format support.\r\n            var popup = document.querySelector('body.format-popups .modal-content .modal-body');\r\n            if (popup !== null) {\r\n                popup.addEventListener('scroll', () => {\r\n                    stickycontents(true);\r\n                });\r\n            }\r\n\r\n            stickycontents(false);\r\n        } else if (contentElem && contentElem.classList.contains('scrollup-stickycontent')) {\r\n            scrollupstickycontents();\r\n        }\r\n\r\n        // Listen the event form the element update.\r\n        contentWrapper().addEventListener('elementupdate', () => {\r\n            ctaaction();\r\n        });\r\n\r\n        // CTA Actions.\r\n        ctaaction();\r\n    }\r\n\r\n    const stickycontents = (popup) => {\r\n\r\n        if (popup) {\r\n            var navbar = document.querySelector('body.format-popups .modal-content .modal-header');\r\n        } else {\r\n            var navbar = document.querySelector('nav.navbar.fixed-top');\r\n        }\r\n\r\n        var navbarSize = navbar !== null ? navbar.clientHeight : 50;\r\n\r\n        if (tocblock() != undefined && tocblock().parentNode.getBoundingClientRect().bottom < navbarSize) {\r\n            displayelementsonsticky();\r\n            if (popup) {\r\n                var rem = (window.innerWidth > 575) ? 1.9 : 0;\r\n                tocblock().style.top = \"calc(\" + navbarSize + \"px + \" + rem + \"rem)\";\r\n            }\r\n        } else {\r\n            hideelementsonsticky();\r\n        }\r\n    }\r\n\r\n    const scrollupstickycontents = () => {\r\n        var oldScrollY = window.scrollY;\r\n        window.onscroll = function (e) {\r\n            if (oldScrollY > window.scrollY) {\r\n                stickycontents(false);\r\n            } else {\r\n                hideelementsonsticky();\r\n            }\r\n            oldScrollY = window.scrollY;\r\n        }\r\n\r\n        // Handle scrolling inside the popup modal.\r\n        const popup = document.querySelector('body.format-popups .modal-content .modal-body');\r\n        if (popup) {\r\n            let oldPopupScrollY = 0;\r\n            popup.addEventListener('scroll', () => {\r\n                if (popup.scrollTop < oldPopupScrollY) {\r\n                    stickycontents(true); // Scrolling up inside the popup.\r\n                } else {\r\n                    hideelementsonsticky(); // Scrolling down inside the popup.\r\n                }\r\n                oldPopupScrollY = popup.scrollTop;\r\n            });\r\n        }\r\n    }\r\n\r\n    const hideelementsonsticky = () => {\r\n        tocblock().classList.remove('fixed-top');\r\n        tableofcontent().classList.remove('header-maxwidth');\r\n        tocprogressbar().forEach((progressbar) => {\r\n            progressbar.classList.add('d-none');\r\n        })\r\n        cdprogressbar().style.display = \"block\";\r\n        hidechaptertitle(false);\r\n        hidemodtitle(false);\r\n        hideactionbutton(false);\r\n        hidegeneralstyle(false);\r\n    }\r\n\r\n    const displayelementsonsticky = () => {\r\n        tocblock().classList.add('fixed-top');\r\n        tableofcontent().classList.add('header-maxwidth');\r\n        tocprogressbar().forEach((progressbar) => {\r\n            progressbar.classList.remove('d-none');\r\n        })\r\n        cdprogressbar().style.display = \"none\";\r\n        hidechaptertitle(true);\r\n        hidemodtitle(true);\r\n        hideactionbutton(true);\r\n        hidegeneralstyle(true);\r\n    }\r\n\r\n    const hidechaptertitle = (display) => {\r\n        var chaptertitle = document.querySelectorAll(SELECTORS.tocchaptertitle);\r\n        chaptertitle.forEach((title) => {\r\n            if (display) {\r\n                if (title.classList.contains('hideonsticky')) {\r\n                    title.style.display = \"none\";\r\n                }\r\n            } else {\r\n                if (title.classList.contains('hideonsticky')) {\r\n                    title.style.display = \"block\";\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    const hidemodtitle = (display) => {\r\n        var modtitle = document.querySelectorAll(SELECTORS.tocmodtitle);\r\n        modtitle.forEach((title) => {\r\n            if (display) {\r\n                if (title.classList.contains('hideonsticky')) {\r\n                    title.style.display = \"none\";\r\n                }\r\n            } else {\r\n                if (title.classList.contains('hideonsticky')) {\r\n                    title.style.display = \"block\";\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    const hideactionbutton = (status) => {\r\n        var actionbutton = document.querySelector('.toc-action-block');\r\n        if (actionbutton != undefined) {\r\n            if (status) {\r\n                actionbutton.style.display = \"none\";\r\n            } else {\r\n                actionbutton.style.display = \"block\";\r\n            }\r\n        }\r\n    }\r\n\r\n    const ctaaction = () => {\r\n        // CTA actions.\r\n        if (actionbutton() != undefined) {\r\n            actionbutton().addEventListener('click', (e) => {\r\n                var chapterid = e.target.dataset.actionid;\r\n                viewtochapter(chapterid);\r\n            });\r\n        }\r\n\r\n        // Chapter title linked.\r\n        var chaptertitlelist = document.querySelectorAll(SELECTORS.chaptertitlelist);\r\n        if (chaptertitlelist != undefined) {\r\n            chaptertitlelist.forEach((title) => {\r\n                title.addEventListener('click', (e) => {\r\n                    var chapterid = e.target.dataset.chapter;\r\n                    viewtochapter(chapterid);\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    const viewtochapter = (chapterid) => {\r\n        var chapterSelector = document.querySelector('li.chapters-list[data-id=\"' + chapterid + '\"]');\r\n        if (chapterSelector != undefined) {\r\n            chapterSelector.scrollIntoView(true);\r\n        }\r\n    }\r\n\r\n    const hidegeneralstyle = (status) => {\r\n        if (generaloptionwrapper() !== undefined) {\r\n            var margin = generaloptionwrapper().dataset.margin;\r\n            var padding = generaloptionwrapper().dataset.padding;\r\n            if (status) {\r\n                generaloptionwrapper().style.margin = \"0px\";\r\n                generaloptionwrapper().style.padding = \"0px\";\r\n            } else {\r\n                generaloptionwrapper().style.margin = margin;\r\n                generaloptionwrapper().style.padding = padding;\r\n            }\r\n        }\r\n    }\r\n\r\n    return {\r\n        init: function () {\r\n            inittableofcontents();\r\n        },\r\n    };\r\n});\r\n"],"names":["define","SELECTORS","tableofcontent","document","querySelector","cdprogressbar","tocprogressbar","querySelectorAll","tocblock","actionbutton","generaloptionwrapper","inittableofcontents","contentElem","height","getBoundingClientRect","parentNode","style","minHeight","classList","contains","addEventListener","stickycontents","window","popup","scrollupstickycontents","ctaaction","navbar","navbarSize","clientHeight","undefined","bottom","displayelementsonsticky","rem","innerWidth","top","hideelementsonsticky","oldScrollY","scrollY","onscroll","e","oldPopupScrollY","scrollTop","remove","forEach","progressbar","add","display","hidechaptertitle","hidemodtitle","hideactionbutton","hidegeneralstyle","title","status","chapterid","target","dataset","actionid","viewtochapter","chaptertitlelist","chapter","chapterSelector","scrollIntoView","margin","padding","init"],"mappings":"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"}