/**
 * Videotime instance selector for auto-complete form element.
 *
 * @module    cdelement_videotime/form-videotime-selector
 * @copyright  2024 bdecent gmbh <https://bdecent.de>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("cdelement_videotime/form-videotime-selector",["core/ajax","jquery","mod_contentdesigner/elements","media_videojs/video-lazy","mod_videotime/player","core/notification"],(function(ajax,$,Elements,videoJS,VimeoPlayer,Notification){return{processResults:function(selector,data){var results=[],i=0;for(i=0;i<data.length;i++)results.push({value:data[i].id,label:data[i].name});return results},transport:function(selector,query,success,failure){var promises;void 0===query&&(query="");var courseid=document.querySelector(selector).dataset.courseid;""==courseid&&(courseid=1);var calls=[{methodname:"cdelement_videotime_get_instance_menu",args:{query:query,limitfrom:0,limitnum:100,courseid:courseid}}];promises=ajax.call(calls),$.when.apply($.when,promises).done((function(data){success(data)})).fail(failure)},updateCourseID:(cmField,fieldName)=>{const courseField=document.querySelector("[name="+fieldName+"]");var el=document.querySelector("[name="+cmField+"]");const updateField=e=>{const courseID=courseField.value;if(el.dataset.courseid=courseID,e){el.value="";var changeEvent=new Event("change");el.dispatchEvent(changeEvent)}};null!==courseField&&null!==el&&(updateField(!1),courseField.addEventListener("change",updateField))},updateNextElements:function(videoTimeID,instanceID){let selector=Elements.selectors.elementContent;var contentElement,player,intervalCheck;selector+='[data-elementshortname="videotime"][data-instanceid="'+instanceID+'"]';var videoJSInterval=setInterval((()=>{(contentElement=document.querySelector(selector+" .video-js, "+selector+" .vimeo-embed"))&&null!==(player=videoJS.getPlayer(contentElement)||new VimeoPlayer(contentElement))&&(clearInterval(videoJSInterval),player.on("pause",verifyCompletion),player.on("ended",verifyCompletion))}),1e3);const verifyCompletion=()=>{ajax.call([{methodname:"cdelement_videotime_verify_completion",args:{instanceid:videoTimeID}}])[0].done((result=>{result&&(clearInterval(intervalCheck),Elements.removeWarning(),Elements.refreshContent())})).fail(Notification.exeception)};intervalCheck=setInterval(verifyCompletion,1e4)}}}));

//# sourceMappingURL=form-videotime-selector.min.js.map