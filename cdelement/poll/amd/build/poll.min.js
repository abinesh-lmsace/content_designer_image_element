/**
 * Initialize the poll element results.
 *
 * @module cdelement_poll/poll
 * @copyright  2024 bdecent gmbh <https://bdecent.de>
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("cdelement_poll/poll",["core/ajax","mod_contentdesigner/elements","core/notification","core/fragment","core/templates"],(function(Ajax,Elements,notification,Fragment,Templates){return{init:function(){document.querySelectorAll(".chapters-list li.element-poll .poll-section").forEach((poll=>{var maxselection=poll.dataset.selectcount,updaterating=poll.dataset.updaterating,checkboxes=poll.querySelectorAll('input[name="answer[]"]');checkboxes.forEach((checkbox=>{checkbox.addEventListener("change",(function(){poll.querySelectorAll('input[name="answer[]"]:checked').length>=maxselection&&maxselection>=1?checkboxes.forEach((function(box){box.checked||(box.disabled=!0)})):checkboxes.forEach((function(box){box.disabled=!1}))}))})),poll.querySelector("form .submit").addEventListener("click",(()=>{var optionids=[];poll.querySelectorAll('input[name="answer[]"]:checked, input[name="answer"]:checked').forEach((function(checkbox){optionids.push(checkbox.value)}));var chartarea=poll.nextElementSibling;Ajax.call([{methodname:"cdelement_poll_store_poll_result",args:{optionids:optionids,pollid:parseInt(poll.dataset.pollid),instanceid:parseInt(poll.dataset.instanceid)},done:function(response){if(response){var args={cmid:Elements.contentDesignerData().cmid,pollid:parseInt(poll.dataset.pollid)};Fragment.loadFragment("cdelement_poll","update_pollchart",Elements.contentDesignerData().contextid,args).done(((html,js)=>{Templates.replaceNodeContents(chartarea,html,js)})).catch(notification.exception);var checkboxes=poll.querySelectorAll('input[name="answer[]"], input[name="answer"]');return 1!=updaterating?(poll.querySelector(".submit").disabled=!0,checkboxes.forEach((checkbox=>{checkbox.disabled=!0}))):(poll.querySelector(".submit").disabled=!1,checkboxes.forEach((function(checkbox){poll.querySelectorAll('input[name="answer[]"]:checked').length>=maxselection&&maxselection>=1&&(checkbox.checked||(checkbox.disabled=!0))}))),Elements.removeWarning(),void Elements.refreshContent()}}}])}))}))}}}));

//# sourceMappingURL=poll.min.js.map